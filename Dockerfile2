
FROM golang:1.23 AS builder

ENV GOPROXY=https://goproxy.cn,direct
WORKDIR /build
COPY go.mod .
COPY go.sum .
RUN go mod download
COPY . .
RUN echo ${GOPROXY}

RUN go build  -ldflags '-w -s' -trimpath -tags with_gvisor

FROM rockylinux:9

COPY --from=builder /build/mihomo /

CMD ["/mihomo"]
